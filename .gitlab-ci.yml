stages:
  - build

variables:
  GO_VERSION: "1.20"

# Build the Go binary
build:
  stage: build
  image: golang:${GO_VERSION}-alpine
  before_script:
    - apk add --no-cache git
  script:
    - echo "Building Go binary..."
    - go mod download
    - CGO_ENABLED=0 GOOS=linux go build -o knowledgebot main.go
    - ls -lh knowledgebot
    - echo "Binary built successfully!"
    - echo ""
    - echo "To build and push Docker image manually, run:"
    - echo "  docker build -t ${HARBOR_REGISTRY:-harbor.test.shopeemobile.com}/${HARBOR_PROJECT:-knowledgebot}/${IMAGE_NAME:-knowledgebot}:latest ."
    - echo "  docker login ${HARBOR_REGISTRY:-harbor.test.shopeemobile.com}"
    - echo "  docker push ${HARBOR_REGISTRY:-harbor.test.shopeemobile.com}/${HARBOR_PROJECT:-knowledgebot}/${IMAGE_NAME:-knowledgebot}:latest"
  artifacts:
    paths:
      - knowledgebot
    expire_in: 1 week
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
    - if: $CI_COMMIT_TAG
