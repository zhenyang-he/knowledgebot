stages:
  - build

variables:
  GO_VERSION: "1.20"

# Build the Go binary
build:
  stage: build
  image: golang:${GO_VERSION}-alpine
  before_script:
    - apk add --no-cache git
  script:
    - echo "Building Go binary..."
    - go mod download
    - CGO_ENABLED=0 GOOS=linux go build -o knowledgebot main.go
    - ls -lh knowledgebot
    - echo "Binary built successfully!"
  artifacts:
    paths:
      - knowledgebot
    expire_in: 1 week
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
    - if: $CI_COMMIT_TAG
